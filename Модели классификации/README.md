#  Классификационная модель для оценки риска ДТП в каршеринге


## Бизнес-задача

**Проблема:** Каршеринговая компания сталкивается с высокими затратами на:
- Страховые выплаты после ДТП
- Ремонт автомобилей
- Юридические издержки
- Потерю репутации из-за аварий

**Текущая ситуация:** Водители получают автомобили без оценки рисков. Система не предупреждает об опасных условиях поездки.

---

##  Цель проекта

Разработать систему оценки риска ДТП, которая:
- **Предсказывает вероятность** виновности водителя в ДТП  
- **Анализирует факторы риска** на основе исторических данных  
- **Даёт рекомендации** по безопасности перед поездкой  
- **Снижает аварийность** на 15-20% через профилактику  



## Описание данных

### База данных: `data-science-vehicle-db`

#### Основные таблицы:
1. **`collisions`** - общая информация о ДТП (56К+ записей)
2. **`parties`** - данные об участниках аварий  
3. **`vehicles`** - информация о транспортных средствах

#### Ключевые признаки:
- **Целевая переменная:** `at_fault` (1 - виновен, 0 - не виновен)
- **Географические:** округ, город, тип местности
- **Дорожные:** состояние покрытия, наличие перекрёстка, расстояние
- **Погодные:** условия во время ДТП
- **Транспортные:** тип автомобиля, возраст, коробка передач

#### Ограничения для модели:
- Только автомобили (`party_type = 'car'`)
- Только 2012 год
- Исключены ДТП с царапинами
- Обязательный фактор: возраст автомобиля


---

##  Методология

### 1. **Предобработка данных**
- Очистка от выбросов и аномалий
- Заполнение пропусков (медианой, модой)
- Удаление дубликатов
- Кодирование категориальных признаков (One-Hot Encoding)
- Масштабирование числовых признаков

### 2. **Исследовательский анализ (EDA)**
- Анализ распределения целевой переменной
- Визуализация факторов риска
- Корреляционный анализ (PhiK-матрица)
- Анализ сезонности аварий

### 3. **Моделирование**
**Протестированные модели:**
- CatBoost Classifier
- Logistic Regression
- K-Nearest Neighbors

**Метрика:** F1-Score (баланс precision и recall)

**Валидация:** Стратифицированное разбиение 70/30, 3-fold CV

### 4. **Оптимизация**
- RandomizedSearchCV для подбора гиперпараметров
- Оптимизация порога классификации
- Анализ важности признаков (SHAP)

---

##  Результаты

### Лучшая модель: **CatBoostClassifier**
- **F1-Score:** 67.05% (после оптимизации порога)
- **Recall:** 89.61% (ловим 90% виновников)
- **Precision:** 53.95%

### Матрица ошибок (оптимальный порог 0.37):

Прогноз
          Виновен | Не виновен
Факт Виновен 7481 | 918
Не виновен   6435 | 1787


### Топ-3 важнейших признака:
1. **Тип кузова (седан)** - наиболее уязвимая категория
2. **Возраст автомобиля** - ключевой фактор по требованию заказчика
3. **Наличие перекрёстка** - зона повышенного риска

---

##  Ключевые выводы

- 77.9% ДТП происходят **вне перекрёстков**
- Самый аварийный месяц: **январь**
- Лос-Анджелес - лидер по количеству ДТП
- На автоматической КПП чаще нарушают ПДД

##  Технологический стек

**Анализ данных:**
- `pandas`, `numpy`, `scipy`
- `matplotlib`, `seaborn`
- `phik` (корреляционный анализ)

**Машинное обучение:**
- `scikit-learn` (классификация, валидация)
- `catboost` (градиентный бустинг)
- `shap` (интерпретация моделей)

**Работа с БД:**
- `SQLAlchemy` (PostgreSQL connector)
- `psycopg2`

**Утилиты:**
- `warnings` (управление предупреждениями)
- `gc` (управление памятью)


```python

```
